<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.c4.routy.domain.place.mapper.PlaceMapper">

    <!-- 여러 장소 한꺼번에 저장 (배치 insert) -->
    <insert id="insertPlacesBatch">
        INSERT INTO tbl_travel (
        duration_id,
        travel_order,
        estimated_travel_time,
        place_name,
        latitude,
        longitude,
        category_code,
        category_group_name,
        address_name,
        place_url,
        description,
        image_path,
        run_time,
        start_time,
        end_time
        )
        VALUES
        <foreach collection="places" item="p" separator=",">
            (
            #{p.durationId},
            #{p.travelOrder},
            #{p.estimatedTravelTime},
            #{p.placeName},
            #{p.latitude},
            #{p.longitude},
            #{p.categoryCode},
            #{p.categoryGroupName},
            #{p.addressName},
            #{p.placeUrl},
            #{p.description},
            #{p.imagePath},
            #{p.runTime},
            #{p.startTime},
            #{p.endTime}
            )
        </foreach>
    </insert>

    <!-- 단일 장소 저장 -->
    <insert id="insertPlace">
        INSERT INTO tbl_travel (
            duration_id,
            travel_order,
            estimated_travel_time,
            place_name,
            latitude,
            longitude,
            category_code,
            category_group_name,
            address_name,
            place_url,
            description,
            image_path,
            run_time,
            start_time,
            end_time
        ) VALUES (
                     #{durationId},
                     #{travelOrder},
                     #{estimatedTravelTime},
                     #{placeName},
                     #{latitude},
                     #{longitude},
                     #{categoryCode},
                     #{categoryGroupName},
                     #{addressName},
                     #{placeUrl},
                     #{description},
                     #{imagePath},
                     #{runTime},
                     #{startTime},
                     #{endTime}
                 )
    </insert>

    <!-- 일정(planId)에 속한 장소 목록 조회 -->
    <select id="findPlacesByPlanId" resultType="com.c4.routy.domain.place.dto.PlaceResponseDTO">
        SELECT
            t.travel_id AS travelId,
            t.travel_order AS travelOrder,
            t.estimated_travel_time AS estimatedTravelTime,
            t.place_name AS placeName,
            t.latitude,
            t.longitude,
            t.category_code AS categoryCode,
            t.category_group_name AS categoryGroupName,
            t.address_name AS addressName,
            t.place_url AS placeUrl,
            t.description,
            t.image_path AS imagePath,
            t.run_time AS runTime,
            t.start_time AS startTime,
            t.end_Time AS endTime,
            t.duration_id AS durationId,
            d.plan_id AS planId
        FROM tbl_travel t
                 JOIN tbl_duration d ON t.duration_id = d.duration_id
        WHERE d.plan_id = #{planId}
        ORDER BY t.travel_order ASC
    </select>

</mapper>
